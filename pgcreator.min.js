export default class AppRec{constructor({form:r,report:e}={}){if(!r&&!e)throw new Error("Either form or report must be provided");this.form=r,this.report=e,this.records=[],this.count=""}_checkSDK(){if(!window.ZOHO?.CREATOR?.UTIL)throw new Error("Zoho Creator SDK not initialized")}_validateResponse(r,e="Zoho API call"){if(!r||"object"!=typeof r)throw new Error(`${e} returned an invalid response`);if(r.code&&3100===r.code)return[];if(r.code&&3e3!==r.code)throw new Error(`${e} failed (${r.code}): ${r.message||"Unknown error"}`);return"Count"===e?r.result||"":r.data||[]}_baseConfig(){return{}}_normalize(r){return r&&"object"==typeof r?{id:r.ID||r.id,...r}:r}clear(){this.records=[]}async create(r={}){if(this._checkSDK(),!this.form)throw new Error("Form name required for create");var e={form_name:this.form,payload:{data:r}};const t=await ZOHO.CREATOR.DATA.addRecords(e),o=this._validateResponse(t,"Create"),i=r;return i.id=o,this.records.push(this._normalize(i)),i}async read(r="",e="all",t=[]){this.clear();const o={report_name:this.report,criteria:r||"",field_config:e};t.length>0&&"custom"===e&&(o.fields=t);let i=!0,a=null;for(;i;){a?o.record_cursor=a:delete o.record_cursor;try{const r=await ZOHO.CREATOR.DATA.getRecords(o),e=this._validateResponse(r,"Read");this.records.push(...e.map(r=>this._normalize(r))),a=r.record_cursor,i=!!a}catch(r){throw console.error("Error in read:",r),r}}return this.records}async updateById(r,e={}){if(this._checkSDK(),!this.form)throw new Error("Form name required for update");if(!r)throw new Error("recordId is required");const t={report_name:this.report,id:r,payload:{data:e}},o=await ZOHO.CREATOR.DATA.updateRecordById(t),i=this._validateResponse(o,"Update");return this.records=i.map(r=>this._normalize(r)),this.records}async deleteById(r){if(this._checkSDK(),!this.form)throw new Error("Form name required for delete");if(!r)throw new Error("recordId is required");var e={report_name:this.report,id:r};try{const r=await ZOHO.CREATOR.DATA.deleteRecordById(e);this._validateResponse(r,"Delete")}catch(r){throw console.error("Error in deleteById:",r),r}return!0}async countRecords(r=""){const e={report_name:this.report};r&&(e.criteria=r);try{const r=await ZOHO.CREATOR.DATA.getRecordCount(e),t=this._validateResponse(r,"Count");this.count=t.records_count}catch(r){throw console.error("Error in read:",r),r}return this.count}viewById(r){return this.records.find(e=>e.id===r)}viewByField(r,e){return this.records.filter(t=>t[r]===e)}}export async function initZoho(){const r=await ZOHO.CREATOR.UTIL.getInitParams(),e=await ZOHO.CREATOR.UTIL.getQueryParams(),t=e.usersettings?JSON.parse(e.usersettings):"",o=document.referrer||window.parent?.location?.href||"";try{if(o){const e=new URL(o);r.parentDomain=e.hostname}}catch(e){r.parentDomain=""}return{...r,...t}}export async function redirect(r,e,t){const o={action:r,url:e,window:t};await ZOHO.CREATOR.UTIL.navigateParentURL(o)}
